<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#51cf66">
    <title>Bestellung erfolgreich - Eatech</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Confetti Animation -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    
    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="js/multilingual.js"></script>
</head>
<body>
    <!-- Success Animation -->
    <div class="success-animation" id="successAnimation">
        <div class="success-circle">
            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
        </div>
        <h1 class="success-title">Bestellung erfolgreich!</h1>
        <p class="success-subtitle">Vielen Dank f√ºr Ihre Bestellung</p>
    </div>

    <!-- Language Selector -->
    <div class="language-selector floating">
        <!-- Wird von multilingual.js generiert -->
    </div>

    <!-- Main Container -->
    <div class="success-container">
        <!-- Success Header -->
        <header class="success-header">
            <div class="brand-section">
                <div class="brand-logo">
                    <i class="fas fa-fire"></i>
                    <span>Eatech</span>
                </div>
                <div class="header-actions">
                    <a href="index.html" class="home-link">
                        <i class="fas fa-home"></i>
                        <span data-i18n="nav.home">Startseite</span>
                    </a>
                </div>
            </div>
        </header>

        <!-- Success Content -->
        <div class="success-content">
            <!-- Order Confirmation Card -->
            <div class="confirmation-card animated">
                <div class="confirmation-header">
                    <div class="confirmation-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="confirmation-text">
                        <h1 data-i18n="success.thankYou">Vielen Dank f√ºr Ihre Bestellung!</h1>
                        <p data-i18n="success.confirmed">Ihre Bestellung wurde erfolgreich aufgegeben.</p>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="order-summary-section">
                    <div class="order-number-display">
                        <span class="order-label" data-i18n="success.orderNumber">Bestellnummer</span>
                        <div class="order-number" id="orderNumber">#000000</div>
                        <button class="copy-button" onclick="copyOrderNumber()">
                            <i class="fas fa-copy"></i>
                            <span data-i18n="success.copy">Kopieren</span>
                        </button>
                    </div>

                    <!-- Customer Info -->
                    <div class="customer-info" id="customerInfo">
                        <div class="info-item">
                            <i class="fas fa-user"></i>
                            <span id="customerName">Name</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-phone"></i>
                            <span id="customerPhone">Telefon</span>
                        </div>
                        <div class="info-item" id="whatsappInfo" style="display: none;">
                            <i class="fab fa-whatsapp"></i>
                            <span data-i18n="success.whatsappEnabled">WhatsApp-Updates aktiviert</span>
                        </div>
                    </div>

                    <!-- Payment Info -->
                    <div class="payment-info" id="paymentInfo">
                        <div class="payment-badge">
                            <i class="fas fa-check"></i>
                            <span id="paymentStatus">Bezahlt</span>
                        </div>
                        <div class="payment-method" id="paymentMethod">
                            <i class="fas fa-credit-card"></i>
                            <span>Kartenzahlung</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Status Tracker -->
            <div class="status-tracker-card animated">
                <h2 class="section-title">
                    <i class="fas fa-clock"></i>
                    <span data-i18n="success.liveTracking">Live-Verfolgung</span>
                    <span class="live-indicator">
                        <span class="pulse-dot"></span>
                        LIVE
                    </span>
                </h2>

                <!-- Estimated Time -->
                <div class="estimated-time">
                    <div class="time-display">
                        <span class="time-label" data-i18n="success.estimatedTime">Gesch√§tzte Wartezeit</span>
                        <div class="time-value" id="estimatedTime">
                            <span class="time-number">15</span>
                            <span class="time-unit">Min</span>
                        </div>
                    </div>
                    <div class="time-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="timeProgress"></div>
                        </div>
                        <div class="progress-labels">
                            <span>0 Min</span>
                            <span id="maxTime">15 Min</span>
                        </div>
                    </div>
                </div>

                <!-- Status Steps -->
                <div class="status-tracker">
                    <div class="tracker-line">
                        <div class="tracker-progress" id="statusProgress"></div>
                    </div>
                    
                    <div class="tracker-steps">
                        <div class="tracker-step active" id="step-ordered">
                            <div class="step-icon">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <span class="step-label" data-i18n="status.ordered">Bestellt</span>
                            <span class="step-time" id="timeOrdered">--:--</span>
                        </div>
                        
                        <div class="tracker-step" id="step-preparing">
                            <div class="step-icon">
                                <i class="fas fa-fire"></i>
                            </div>
                            <span class="step-label" data-i18n="status.preparing">Zubereitung</span>
                            <span class="step-time" id="timePreparing">--:--</span>
                        </div>
                        
                        <div class="tracker-step" id="step-ready">
                            <div class="step-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <span class="step-label" data-i18n="status.ready">Fertig</span>
                            <span class="step-time" id="timeReady">--:--</span>
                        </div>
                    </div>
                </div>

                <!-- Current Status Message -->
                <div class="status-message-box" id="statusMessage">
                    <div class="message-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="message-text">
                        <h3 id="statusTitle" data-i18n="status.confirmed">Bestellung best√§tigt</h3>
                        <p id="statusDescription" data-i18n="status.preparingSoon">
                            Wir beginnen in K√ºrze mit der Zubereitung Ihrer Bestellung.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Order Items -->
            <div class="order-items-card animated">
                <h2 class="section-title">
                    <i class="fas fa-receipt"></i>
                    <span data-i18n="success.orderDetails">Bestelldetails</span>
                </h2>
                
                <div class="items-list" id="orderItemsList">
                    <!-- Items werden dynamisch eingef√ºgt -->
                </div>
                
                <div class="order-totals">
                    <div class="total-row">
                        <span data-i18n="success.subtotal">Zwischensumme</span>
                        <span id="subtotal">CHF 0.00</span>
                    </div>
                    <div class="total-row final">
                        <span data-i18n="success.total">Gesamt</span>
                        <span id="total">CHF 0.00</span>
                    </div>
                </div>

                <div class="special-requests" id="specialRequests" style="display: none;">
                    <h4>
                        <i class="fas fa-comment-alt"></i>
                        <span data-i18n="success.specialRequests">Besondere W√ºnsche</span>
                    </h4>
                    <p id="specialRequestsText"></p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-section">
                <button class="action-btn primary" onclick="trackOrder()">
                    <i class="fas fa-search-location"></i>
                    <span data-i18n="success.trackOrder">Bestellung verfolgen</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
                
                <button class="action-btn secondary" onclick="newOrder()">
                    <i class="fas fa-plus-circle"></i>
                    <span data-i18n="success.newOrder">Neue Bestellung</span>
                </button>
                
                <div class="help-section">
                    <p data-i18n="success.needHelp">Brauchen Sie Hilfe?</p>
                    <a href="tel:+41791234567" class="help-link">
                        <i class="fas fa-phone"></i>
                        <span>+41 79 123 45 67</span>
                    </a>
                </div>
            </div>

            <!-- Notifications Info -->
            <div class="notifications-card animated">
                <div class="notification-icon">
                    <i class="fas fa-bell"></i>
                </div>
                <div class="notification-content">
                    <h3 data-i18n="success.stayUpdated">Bleiben Sie informiert</h3>
                    <p data-i18n="success.notificationInfo">
                        Sie erhalten eine Benachrichtigung, sobald Ihre Bestellung fertig ist.
                    </p>
                    <div class="notification-channels">
                        <div class="channel active" id="browserNotification">
                            <i class="fas fa-desktop"></i>
                            <span>Browser</span>
                        </div>
                        <div class="channel" id="whatsappNotification">
                            <i class="fab fa-whatsapp"></i>
                            <span>WhatsApp</span>
                        </div>
                        <div class="channel" id="soundNotification">
                            <i class="fas fa-volume-up"></i>
                            <span>Sound</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Notification Popup -->
    <div class="notification-popup" id="notificationPopup">
        <div class="notification-content">
            <i class="fas fa-bell"></i>
            <span id="notificationMessage"></span>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDFBlgWE81iHnACVwOmaU0jL7FV0l_tRmU",
            authDomain: "eatech-foodtruck.firebaseapp.com",
            databaseURL: "https://eatech-foodtruck-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "eatech-foodtruck",
            storageBucket: "eatech-foodtruck.firebasestorage.app",
            messagingSenderId: "261222802445",
            appId: "1:261222802445:web:edde22580422fbced22144"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let currentOrderId = null;
        let currentOrder = null;
        let notificationSound = null;
        let statusCheckInterval = null;
        let elapsedTimeInterval = null;
        let orderStartTime = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize multilingual
            if (window.ml) {
                window.ml.init();
            }

            // Get order ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            currentOrderId = urlParams.get('order');
            const paymentMethod = urlParams.get('payment');

            if (!currentOrderId) {
                window.location.href = 'index.html';
                return;
            }

            // Initialize notification sound
            notificationSound = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+JhoSFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tipublic3Rna2N3em+Jg');

            // Load order details
            await loadOrderDetails(paymentMethod);

            // Show success animation
            showSuccessAnimation();

            // Start monitoring
            startStatusMonitoring();
            startElapsedTimeCounter();

            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        });

        // Show success animation
        function showSuccessAnimation() {
            setTimeout(() => {
                document.getElementById('successAnimation').classList.add('show');
                
                // Fire confetti
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#ff6b6b', '#51cf66', '#4ecdc4', '#ffe66d']
                });
                
                // Hide animation after delay
                setTimeout(() => {
                    document.getElementById('successAnimation').style.display = 'none';
                }, 3000);
            }, 100);
        }

        // Load order details
        async function loadOrderDetails(paymentMethod) {
            try {
                // Try to load from active orders first
                let snapshot = await database.ref(`orders/${currentOrderId}`).once('value');
                currentOrder = snapshot.val();

                if (!currentOrder) {
                    // Check in temp orders (for payment processing)
                    snapshot = await database.ref(`temp-orders/${currentOrderId}`).once('value');
                    currentOrder = snapshot.val();
                    
                    if (currentOrder) {
                        // Move to active orders
                        await database.ref(`orders/${currentOrderId}`).set(currentOrder);
                        await database.ref(`temp-orders/${currentOrderId}`).remove();
                    }
                }

                if (!currentOrder) {
                    showToast('Bestellung nicht gefunden', 'error');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                    return;
                }

                // Display order details
                displayOrderDetails();
                
                // Update payment info
                updatePaymentInfo(paymentMethod || currentOrder.paymentMethod);
                
                // Set order start time
                orderStartTime = currentOrder.timestamp;
                
            } catch (error) {
                console.error('Error loading order:', error);
                showToast('Fehler beim Laden der Bestellung', 'error');
            }
        }

        // Display order details
        function displayOrderDetails() {
            // Order number
            document.getElementById('orderNumber').textContent = `#${currentOrderId}`;
            
            // Customer info
            document.getElementById('customerName').textContent = currentOrder.customer.name;
            document.getElementById('customerPhone').textContent = currentOrder.customer.phone;
            
            // WhatsApp info
            if (currentOrder.customer.whatsapp) {
                document.getElementById('whatsappInfo').style.display = 'flex';
                document.getElementById('whatsappNotification').classList.add('active');
            }
            
            // Estimated time
            const estimatedMinutes = currentOrder.restaurantStatus?.waitTime || 15;
            document.getElementById('estimatedTime').querySelector('.time-number').textContent = estimatedMinutes;
            document.getElementById('maxTime').textContent = `${estimatedMinutes} Min`;
            
            // Order items
            displayOrderItems();
            
            // Special requests
            if (currentOrder.specialRequests) {
                document.getElementById('specialRequests').style.display = 'block';
                document.getElementById('specialRequestsText').textContent = currentOrder.specialRequests;
            }
            
            // Update status
            updateOrderStatus(currentOrder.status || 'new');
        }

        // Display order items
        function displayOrderItems() {
            const container = document.getElementById('orderItemsList');
            const items = currentOrder.items || [];
            
            container.innerHTML = items.map(item => `
                <div class="order-item">
                    <div class="item-icon">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div class="item-info">
                        <h4>${item.name}</h4>
                        <span class="item-meta">
                            ${item.quantity}x √ó CHF ${item.price.toFixed(2)}
                        </span>
                    </div>
                    <div class="item-total">
                        CHF ${(item.quantity * item.price).toFixed(2)}
                    </div>
                </div>
            `).join('');
            
            // Update totals
            const total = currentOrder.total || 0;
            document.getElementById('subtotal').textContent = `CHF ${total.toFixed(2)}`;
            document.getElementById('total').textContent = `CHF ${total.toFixed(2)}`;
        }

        // Update payment info
        function updatePaymentInfo(method) {
            const paymentInfo = document.getElementById('paymentInfo');
            const paymentStatus = document.getElementById('paymentStatus');
            const paymentMethod = document.getElementById('paymentMethod');
            
            if (method === 'card') {
                paymentStatus.textContent = 'Bezahlt';
                paymentMethod.innerHTML = '<i class="fas fa-credit-card"></i><span>Kartenzahlung</span>';
                paymentInfo.classList.add('paid');
            } else if (method === 'cash') {
                paymentStatus.textContent = 'Bei Abholung';
                paymentMethod.innerHTML = '<i class="fas fa-money-bill-wave"></i><span>Barzahlung</span>';
                paymentInfo.classList.add('pending');
            }
        }

        // Update order status
        function updateOrderStatus(status) {
            const steps = ['ordered', 'preparing', 'ready'];
            const currentIndex = steps.indexOf(status === 'new' ? 'ordered' : status);
            
            // Update progress
            const progress = ((currentIndex + 1) / steps.length) * 100;
            document.getElementById('statusProgress').style.width = `${progress}%`;
            
            // Update steps
            steps.forEach((step, index) => {
                const stepElement = document.getElementById(`step-${step}`);
                if (index <= currentIndex) {
                    stepElement.classList.add('active');
                    if (index === currentIndex) {
                        stepElement.classList.add('current');
                    }
                } else {
                    stepElement.classList.remove('active', 'current');
                }
                
                // Update time
                if (index <= currentIndex) {
                    const timeElement = document.getElementById(`time${step.charAt(0).toUpperCase() + step.slice(1)}`);
                    const timestamp = currentOrder.statusUpdates?.[step] || currentOrder.timestamp;
                    const time = new Date(timestamp);
                    timeElement.textContent = time.toLocaleTimeString('de-CH', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                }
            });
            
            // Update status message
            updateStatusMessage(status);
            
            // Handle ready status
            if (status === 'ready') {
                handleOrderReady();
            }
        }

        // Update status message
        function updateStatusMessage(status) {
            const messages = {
                'new': {
                    title: 'Bestellung best√§tigt',
                    description: 'Wir beginnen in K√ºrze mit der Zubereitung Ihrer Bestellung.',
                    icon: 'fa-check-circle'
                },
                'ordered': {
                    title: 'Bestellung eingegangen',
                    description: 'Ihre Bestellung wurde erfolgreich aufgegeben und wartet auf Zubereitung.',
                    icon: 'fa-clock'
                },
                'preparing': {
                    title: 'In Zubereitung',
                    description: 'Ihre Bestellung wird gerade frisch f√ºr Sie zubereitet.',
                    icon: 'fa-fire'
                },
                'ready': {
                    title: 'Fertig zur Abholung!',
                    description: 'Ihre Bestellung ist fertig und wartet auf Sie.',
                    icon: 'fa-bell'
                }
            };
            
            const message = messages[status] || messages['new'];
            document.getElementById('statusTitle').textContent = message.title;
            document.getElementById('statusDescription').textContent = message.description;
            document.querySelector('.message-icon i').className = `fas ${message.icon}`;
            
            if (status === 'ready') {
                document.querySelector('.status-message-box').classList.add('ready');
            }
        }

        // Start status monitoring
        function startStatusMonitoring() {
            // Monitor order status changes
            database.ref(`orders/${currentOrderId}`).on('value', (snapshot) => {
                const order = snapshot.val();
                if (order) {
                    const previousStatus = currentOrder?.status;
                    currentOrder = order;
                    
                    if (previousStatus && previousStatus !== order.status) {
                        // Status changed
                        updateOrderStatus(order.status);
                        showStatusNotification(order.status);
                        
                        if (order.status === 'ready') {
                            stopElapsedTimeCounter();
                        }
                    }
                }
            });
        }

        // Start elapsed time counter
        function startElapsedTimeCounter() {
            updateElapsedTime(); // Initial update
            
            elapsedTimeInterval = setInterval(() => {
                updateElapsedTime();
            }, 1000); // Update every second
        }

        // Update elapsed time
        function updateElapsedTime() {
            if (!orderStartTime || currentOrder?.status === 'ready') return;
            
            const elapsed = Date.now() - orderStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const estimatedMinutes = currentOrder.restaurantStatus?.waitTime || 15;
            
            // Update progress bar
            const progress = Math.min((minutes / estimatedMinutes) * 100, 100);
            document.getElementById('timeProgress').style.width = `${progress}%`;
            
            // Update remaining time if not ready
            if (currentOrder?.status !== 'ready') {
                const remaining = Math.max(0, estimatedMinutes - minutes);
                document.querySelector('.time-number').textContent = remaining;
                
                // Change color based on progress
                if (progress > 90) {
                    document.querySelector('.time-value').classList.add('alert');
                } else if (progress > 70) {
                    document.querySelector('.time-value').classList.add('warning');
                }
            }
        }

        // Stop elapsed time counter
        function stopElapsedTimeCounter() {
            if (elapsedTimeInterval) {
                clearInterval(elapsedTimeInterval);
                elapsedTimeInterval = null;
            }
        }

        // Handle order ready
        function handleOrderReady() {
            // Update UI
            document.querySelector('.time-number').textContent = '0';
            document.querySelector('.time-value').classList.add('ready');
            document.getElementById('timeProgress').style.width = '100%';
            
            // Celebration
            confetti({
                particleCount: 50,
                angle: 90,
                spread: 45,
                origin: { x: 0.5, y: 0.8 },
                colors: ['#51cf66', '#10b981', '#34d399']
            });
            
            // Play sound
            if (notificationSound) {
                notificationSound.play();
            }
        }

        // Show status notification
        function showStatusNotification(status) {
            const messages = {
                'preparing': 'Ihre Bestellung wird jetzt zubereitet!',
                'ready': 'üéâ Ihre Bestellung ist fertig zur Abholung!'
            };
            
            const message = messages[status];
            if (!message) return;
            
            // Browser notification
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('Eatech - Status Update', {
                    body: message,
                    icon: '/icons/icon-192x192.png',
                    badge: '/icons/icon-72x72.png',
                    vibrate: [200, 100, 200]
                });
            }
            
            // In-app notification
            showNotificationPopup(message);
            
            // Play sound
            if (notificationSound && status === 'ready') {
                notificationSound.play();
            }
        }

        // Show notification popup
        function showNotificationPopup(message) {
            const popup = document.getElementById('notificationPopup');
            document.getElementById('notificationMessage').textContent = message;
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 5000);
        }

        // Copy order number
        function copyOrderNumber() {
            const orderNumber = currentOrderId;
            navigator.clipboard.writeText(orderNumber).then(() => {
                showToast('Bestellnummer kopiert!', 'success');
                
                // Change button temporarily
                const button = event.target.closest('button');
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i><span>Kopiert!</span>';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('copied');
                }, 2000);
            });
        }

        // Track order
        function trackOrder() {
            window.location.href = `track.html?order=${currentOrderId}`;
        }

        // New order
        function newOrder() {
            // Clear cart from localStorage
            localStorage.removeItem('eatech_cart');
            window.location.href = 'index.html';
        }

        // Show toast
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            stopElapsedTimeCounter();
            database.ref(`orders/${currentOrderId}`).off();
        });
    </script>

    <style>
        /* Success Animation */
        .success-animation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 11, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .success-animation.show {
            opacity: 1;
        }

        .success-circle {
            width: 120px;
            height: 120px;
            margin-bottom: 2rem;
        }

        .checkmark {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #51cf66;
            stroke-miterlimit: 10;
            animation: scale 0.3s ease-in-out 0.9s both;
        }

        .checkmark-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 3;
            stroke-miterlimit: 10;
            stroke: #51cf66;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .checkmark-check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            stroke-width: 3;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }

        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }

        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }

        .success-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
            animation: fadeInUp 0.5s ease 0.5s both;
        }

        .success-subtitle {
            font-size: 1.125rem;
            color: rgba(255, 255, 255, 0.6);
            animation: fadeInUp 0.5s ease 0.7s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Container */
        .success-container {
            min-height: 100vh;
            background: #0a0a0b;
        }

        /* Header */
        .success-header {
            background: rgba(10, 10, 11, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .brand-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: #ff6b6b;
        }

        .brand-logo i {
            font-size: 1.5rem;
        }

        .home-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .home-link:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Content */
        .success-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Confirmation Card */
        .confirmation-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .confirmation-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .confirmation-icon {
            width: 72px;
            height: 72px;
            background: linear-gradient(135deg, rgba(81, 207, 102, 0.2), rgba(16, 185, 129, 0.1));
            border: 2px solid #51cf66;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .confirmation-icon i {
            font-size: 2rem;
            color: #51cf66;
        }

        .confirmation-text h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.25rem;
        }

        .confirmation-text p {
            color: rgba(255, 255, 255, 0.6);
            margin: 0;
        }

        /* Order Number Display */
        .order-number-display {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            margin-bottom: 1.5rem;
        }

        .order-label {
            display: block;
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.5rem;
        }

        .order-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ff6b6b;
            letter-spacing: 2px;
            margin-bottom: 1rem;
        }

        .copy-button {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .copy-button:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .copy-button.copied {
            background: rgba(81, 207, 102, 0.1);
            border-color: #51cf66;
            color: #51cf66;
        }

        /* Customer Info */
        .customer-info {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-item i {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Payment Info */
        .payment-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .payment-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(81, 207, 102, 0.1);
            border: 1px solid #51cf66;
            border-radius: 8px;
            color: #51cf66;
            font-weight: 600;
        }

        .payment-info.pending .payment-badge {
            background: rgba(255, 203, 107, 0.1);
            border-color: #ffcb6b;
            color: #ffcb6b;
        }

        .payment-method {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Status Tracker Card */
        .status-tracker-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: white;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid #ff6b6b;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #ff6b6b;
            margin-left: auto;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            background: #ff6b6b;
            border-radius: 50%;
            animation: pulseDot 2s ease-in-out infinite;
        }

        @keyframes pulseDot {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.7; }
        }

        /* Estimated Time */
        .estimated-time {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .time-display {
            text-align: center;
            margin-bottom: 1rem;
        }

        .time-label {
            display: block;
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.5rem;
        }

        .time-value {
            display: inline-flex;
            align-items: baseline;
            gap: 0.25rem;
            font-size: 3rem;
            font-weight: 700;
            color: white;
            transition: all 0.3s ease;
        }

        .time-value.warning {
            color: #ffcb6b;
        }

        .time-value.alert {
            color: #ff6b6b;
        }

        .time-value.ready {
            color: #51cf66;
        }

        .time-unit {
            font-size: 1.5rem;
            font-weight: 400;
            opacity: 0.6;
        }

        .time-progress {
            margin-top: 1rem;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ff5757);
            border-radius: 4px;
            transition: width 1s ease;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
        }

        /* Status Tracker */
        .status-tracker {
            position: relative;
            margin-bottom: 2rem;
        }

        .tracker-line {
            position: absolute;
            top: 30px;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }

        .tracker-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #51cf66, #10b981);
            border-radius: 2px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(81, 207, 102, 0.5);
        }

        .tracker-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }

        .tracker-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .step-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.05);
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .tracker-step.active .step-icon {
            background: rgba(81, 207, 102, 0.1);
            border-color: #51cf66;
        }

        .tracker-step.current .step-icon {
            background: #51cf66;
            border-color: #51cf66;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(81, 207, 102, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(81, 207, 102, 0); }
        }

        .tracker-step.active .step-icon i,
        .tracker-step.current .step-icon i {
            color: white;
        }

        .step-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
        }

        .tracker-step.active .step-label {
            color: white;
        }

        .step-time {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.4);
        }

        /* Status Message Box */
        .status-message-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            transition: all 0.3s ease;
        }

        .status-message-box.ready {
            background: rgba(81, 207, 102, 0.1);
            border-color: rgba(81, 207, 102, 0.3);
        }

        .message-icon {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .message-icon i {
            font-size: 1.25rem;
            color: #ff6b6b;
        }

        .status-message-box.ready .message-icon i {
            color: #51cf66;
        }

        .message-text h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.25rem;
        }

        .message-text p {
            color: rgba(255, 255, 255, 0.6);
            margin: 0;
        }

        /* Order Items Card */
        .order-items-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .items-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
        }

        .item-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .item-icon i {
            color: #ff6b6b;
        }

        .item-info {
            flex: 1;
        }

        .item-info h4 {
            font-weight: 600;
            color: white;
            margin-bottom: 0.25rem;
        }

        .item-meta {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .item-total {
            font-weight: 600;
            color: white;
        }

        /* Order Totals */
        .order-totals {
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            color: rgba(255, 255, 255, 0.6);
        }

        .total-row.final {
            font-weight: 600;
            font-size: 1.125rem;
            color: white;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Special Requests */
        .special-requests {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(255, 203, 107, 0.1);
            border: 1px solid rgba(255, 203, 107, 0.3);
            border-radius: 12px;
        }

        .special-requests h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: #ffcb6b;
            margin-bottom: 0.5rem;
        }

        .special-requests p {
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
        }

        /* Action Section */
        .action-section {
            text-align: center;
            margin-top: 2rem;
        }

        .action-btn {
            width: 100%;
            padding: 1.25rem;
            border: none;
            border-radius: 16px;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #ff6b6b, #ff5757);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .action-btn.primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .action-btn.primary:active::before {
            width: 300px;
            height: 300px;
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        .action-btn.primary i:last-child {
            transition: transform 0.3s ease;
        }

        .action-btn.primary:hover i:last-child {
            transform: translateX(5px);
        }

        .action-btn.secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }

        .action-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Help Section */
        .help-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .help-section p {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.5rem;
        }

        .help-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #ff6b6b;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .help-link:hover {
            color: #ff5757;
            transform: translateY(-2px);
        }

        /* Notifications Card */
        .notifications-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 24px;
            padding: 2rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .notification-icon {
            width: 64px;
            height: 64px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-icon i {
            font-size: 1.75rem;
            color: #3b82f6;
        }

        .notification-content h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.5rem;
        }

        .notification-content p {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 1rem;
        }

        .notification-channels {
            display: flex;
            gap: 0.75rem;
        }

        .channel {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .channel.active {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* Notification Popup */
        .notification-popup {
            position: fixed;
            top: 24px;
            right: 24px;
            background: linear-gradient(135deg, rgba(81, 207, 102, 0.95), rgba(16, 185, 129, 0.95));
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 400px;
        }

        .notification-popup.show {
            transform: translateX(0);
        }

        .notification-popup i {
            font-size: 20px;
        }

        /* Animated elements */
        .animated {
            animation: fadeInUp 0.6s ease;
            animation-fill-mode: both;
        }

        .confirmation-card { animation-delay: 0.1s; }
        .status-tracker-card { animation-delay: 0.2s; }
        .order-items-card { animation-delay: 0.3s; }
        .notifications-card { animation-delay: 0.4s; }

        /* Responsive */
        @media (max-width: 768px) {
            .success-content {
                padding: 1rem;
            }

            .confirmation-header {
                flex-direction: column;
                text-align: center;
            }

            .confirmation-text h1 {
                font-size: 1.5rem;
            }

            .order-number {
                font-size: 2rem;
            }

            .time-value {
                font-size: 2.5rem;
            }

            .tracker-steps {
                overflow-x: auto;
                padding-bottom: 1rem;
            }

            .customer-info {
                flex-direction: column;
            }

            .info-item {
                width: 100%;
                justify-content: center;
            }

            .notifications-card {
                flex-direction: column;
                text-align: center;
            }

            .notification-channels {
                width: 100%;
                justify-content: center;
            }

            .notification-popup {
                right: 12px;
                left: 12px;
                max-width: none;
            }
        }
    </style>
</body>
</html>